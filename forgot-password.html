<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        // ----------------------------------------------------
        // 1. INITIALIZE SUPABASE DIRECTLY HERE (Fixes the 404)
        // ----------------------------------------------------
        const supabaseUrl = 'https://abatvqodkwjdefhwwynj.supabase.co'; 
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFiYXR2cW9ka3dqZGVmaHd3eW5qIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2ODY0OTYwNSwiZXhwIjoyMDg0MjI1NjA1fQ.JAvWPoWjL7GWpewP2Bq2dakBGPs2l-lulIu7tiJYVz0';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // ----------------------------------------------------
        // 2. SEND RESET LINK FUNCTION
        // ----------------------------------------------------
        async function sendResetLink() {
            const email = document.getElementById('email').value;
            const btn = document.querySelector('button');
            const msg = document.getElementById('message');
            
            if(!email) { alert("Please enter an email."); return; }

            // UI Feedback
            btn.innerText = "Sending...";
            btn.disabled = true;
            msg.innerText = "";

            try {
                // Check if Supabase loaded correctly
                if (!supabase || !supabase.auth) {
                    throw new Error("Supabase not initialized. Check your URL/Keys.");
                }

                console.log("Sending email to:", email);

                const { data, error } = await supabase.auth.resetPasswordForEmail(email, {
                    // Fix: Use the current window location to build the link
                    redirectTo: window.location.origin + '/reset-password.html',
                });

                if (error) {
                    console.error("Supabase Error:", error);
                    alert("❌ Error: " + error.message);
                    btn.innerText = "Try Again";
                    btn.disabled = false;
                } else {
                    console.log("Success:", data);
                    msg.innerText = "✅ Link sent! Check your Inbox (and Spam).";
                    msg.style.color = "#00ff88";
                    btn.innerText = "Sent";
                    alert("✅ Link sent! Check your Inbox.");
                }

            } catch (err) {
                console.error("System Error:", err);
                alert("❌ System Error: " + err.message);
                btn.innerText = "Try Again";
                btn.disabled = false;
            }
        }
    </script>
