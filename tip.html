<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Support Me | xdtip</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        /* Special Styles just for Tipping Page */
        .profile-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .avatar-circle {
            width: 80px; height: 80px;
            background: #222;
            border-radius: 50%;
            margin: 0 auto 15px auto;
            display: flex; align-items: center; justify-content: center;
            font-size: 30px; border: 2px solid #ff3b3b;
            color: #fff;
        }
        .chip-grid {
            display: flex; gap: 10px; margin-bottom: 15px;
        }
        .chip {
            flex: 1; padding: 10px;
            background: #111; border: 1px solid #333;
            color: white; border-radius: 8px; cursor: pointer;
            text-align: center; transition: 0.2s;
        }
        .chip:hover, .chip.active {
            background: #ff3b3b; border-color: #ff3b3b;
        }
    </style>
</head>
<body>

    <nav>
        <div class="logo">xdtip<span class="dot">.</span></div>
        <a href="dashboard.html" style="font-size:14px;">Back to Dashboard</a>
    </nav>

    <div class="container" style="max-width: 450px; margin-top: 60px;">

        <form id="tip-form">
            <input type="hidden" id="receiver">

            <label style="font-size: 12px; color: #666; font-weight: bold;">SELECT AMOUNT</label>
            <div class="chip-grid">
                <div class="chip" onclick="setAmount(10)">10</div>
                <div class="chip" onclick="setAmount(100)">100</div>
                <div class="chip" onclick="setAmount(500)">500</div>
            </div>
            <input type="number" id="amount" placeholder="Or enter custom amount..." min="10" required>
            
            <label style="font-size: 12px; color: #666; font-weight: bold; margin-top: 10px; display:block;">YOUR MESSAGE</label>
            <textarea id="message" rows="3" placeholder="Say something nice for the alert..." required 
                style="width: 100%; padding: 12px; background: #222; border: 1px solid #333; color: white; border-radius: 6px; box-sizing: border-box; resize: none;"></textarea>
            
            <button type="submit" class="btn" style="width: 100%; margin-top: 20px;">Send Support</button>
        </form>
    </div>

    <footer>
        <p>&copy; 2024 xdtip. All rights reserved.</p>
    </footer>

    <script>
        // ‚ö†Ô∏è REPLACE WITH YOUR RENDER URL
        const API_URL = "https://xdtip-backend.onrender.com"; 

        // 1. Load Creator Profile on Start
        window.onload = async function() {
            const urlParams = new URLSearchParams(window.location.search);
            const username = urlParams.get('u');

            if (username) {
                document.getElementById('receiver').value = username;
                
                try {
                    // Fetch Creator Details (Logo)
                    const res = await fetch(`${API_URL}/profile/${username}`);
                    const data = await res.json();

                    if (data.success) {
                        document.getElementById('creator-name').innerText = data.user.username;
                        
                        // IF LOGO EXISTS, SHOW IT. ELSE SHOW PLACEHOLDER.
                        if (data.user.logo_url) {
                            const avatarBox = document.getElementById('avatar-placeholder');
                            avatarBox.innerHTML = `<img src="${data.user.logo_url}" style="width:100%; height:100%; border-radius:50%; object-fit:cover;">`;
                            avatarBox.style.border = "2px solid #ff3b3b";
                        } else {
                            document.getElementById('avatar-placeholder').innerText = username.charAt(0).toUpperCase();
                        }
                    }
                } catch (err) {
                    console.error("Could not load profile");
                }
            } else {
                // ... (No changes to manual entry logic) ...
            }
        };

        // ... (Keep the rest of setAmount and submit logic same) ...
        
        function setAmount(val) {
             // ... keep existing code ...
             document.getElementById('amount').value = val;
             document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
             event.target.classList.add('active');
        }

        document.getElementById('tip-form').addEventListener('submit', async (e) => {
             // ... keep existing code ...
             // (Copy the submit logic from the previous tip.html I gave you)
             e.preventDefault();
            const token = localStorage.getItem('token');
            if(!token) {
                alert("Please Login to send a tip!");
                return window.location.href = "login.html";
            }

            const receiverUsername = document.getElementById('receiver').value;
            const amount = document.getElementById('amount').value;
            const message = document.getElementById('message').value;
            const btn = e.target.querySelector('button');

            try {
                btn.innerText = "Sending...";
                const res = await fetch(`${API_URL}/tip`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ receiverUsername, amount, message })
                });

                const data = await res.json();
                
                if (data.success) {
                    alert("Tip Sent Successfully! üéâ");
                    window.location.href = "dashboard.html";
                } else {
                    alert("Failed: " + data.error);
                }
            } catch (err) {
                alert("Server Error");
            } finally {
                btn.innerText = "Send Support";
            }
        });
    </script>
</body>
</html>



