<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Send a Tip | xdtip</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <nav>
        <div class="logo">xdtip<span class="dot">.</span></div>
        <div class="nav-links">
            <a href="dashboard.html">&larr; Dashboard</a>
        </div>
    </nav>

    <div class="container" style="max-width: 500px;">
        <div style="text-align: center; margin-bottom: 30px;">
            <h1 style="margin: 0;">Send a Tip</h1>
            <p style="color: #888; font-size: 14px;">Support your favorite creator instantly.</p>
        </div>

        <form id="tip-form">
            <label style="font-size: 12px; color: #666; font-weight: bold;">CREATOR USERNAME</label>
            <input type="text" id="receiver" placeholder="Who are you tipping?" required>
            
            <label style="font-size: 12px; color: #666; font-weight: bold;">AMOUNT (TOKENS)</label>
            <input type="number" id="amount" placeholder="Min 10 Tokens" min="10" required>
            
            <label style="font-size: 12px; color: #666; font-weight: bold;">MESSAGE (FOR STREAM)</label>
            <input type="text" id="message" placeholder="Say something nice..." required>
            
            <button type="submit" class="btn" style="width: 100%; margin-top: 10px;">Send Tip</button>
        </form>
    </div>

    <script>
        // REPLACE WITH YOUR RENDER URL
        const API_URL = "https://xdtip-backend.onrender.com"; 

        document.getElementById('tip-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const token = localStorage.getItem('token');
            if(!token) return window.location.href = "login.html";

            const receiverUsername = document.getElementById('receiver').value;
            const amount = document.getElementById('amount').value;
            const message = document.getElementById('message').value;
            const btn = e.target.querySelector('button');

            try {
                btn.innerText = "Sending...";
                const res = await fetch(`${API_URL}/tip`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ receiverUsername, amount, message })
                });

                const data = await res.json();
                
                if (data.success) {
                    alert("Tip Sent Successfully! ðŸŽ‰");
                    window.location.href = "dashboard.html";
                } else {
                    alert("Failed: " + data.error);
                }
            } catch (err) {
                alert("Server Error");
            } finally {
                btn.innerText = "Send Tip";
            }
        });

        // ... previous code ...

    // ADD THIS AT THE BOTTOM OF YOUR SCRIPT
    // Auto-fill Receiver from URL (e.g., tip.html?u=Ninja)
    window.onload = function() {
        const urlParams = new URLSearchParams(window.location.search);
        const username = urlParams.get('u');
        if (username) {
            document.getElementById('receiver').value = username;
            document.getElementById('receiver').setAttribute('readonly', true); // Lock it so they can't change it
        }
    };
        
    </script>
<footer>
        <p>&copy; 2024 xdtip. All rights reserved.</p>
        <div class="footer-links">
            <a href="#">Privacy Policy</a>
            <a href="#">Terms of Service</a>
            <a href="#">Refund Policy</a>
            <a href="mailto:support@xdtip.com">Contact Us</a>
        </div>
    </footer>
</body>

</html>
